<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Tenso by avoidwork</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Tenso</h1>
      <h2 class="project-tagline">Tensō is an elastic REST API gateway for node.js</h2>
      <a href="https://github.com/avoidwork/tenso" class="btn">View on GitHub</a>
      <a href="https://github.com/avoidwork/tenso/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/avoidwork/tenso/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="tensō" class="anchor" href="#tens%C5%8D" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Tensō</h1>

<p><a href="http://travis-ci.org/avoidwork/tenso"><img src="https://secure.travis-ci.org/avoidwork/tenso.svg" alt="build status"></a> <a href="https://gitter.im/avoidwork/tenso?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge"><img src="https://badges.gitter.im/Join%20Chat.svg" alt="Gitter"></a></p>

<p>Tensō is a REST API gateway for node.js, designed to simplify the implementation of APIs.</p>

<p>Tensō will handle the serialization &amp; creation of hypermedia links, all you have to do is give it <code>Arrays</code> or <code>Objects</code>.</p>

<h2>
<a id="example" class="anchor" href="#example" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Example</h2>

<p>Creating an API with Tensō can be as simple as one statement.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">"</span>tenso<span class="pl-pds">"</span></span>)({routes<span class="pl-k">:</span> <span class="pl-c1">require</span>(<span class="pl-c1">__dirname</span><span class="pl-k">+</span><span class="pl-s"><span class="pl-pds">"</span>/routes.js<span class="pl-pds">"</span></span>)});</pre></div>

<h3>
<a id="creating-routes" class="anchor" href="#creating-routes" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Creating Routes</h3>

<p>Routes are loaded as a module, with each HTTP method as an export, affording a very customizable API server.</p>

<p>Route handlers have the context of the Tensō server, i.e. <code>this</code> will allow you to send a response with <code>this.respond(req, res, body[, status, headers])</code>. You can also use <code>res</code> to <code>res.respond(body[, status, headers])</code>, <code>res.redirect(url)</code>, or <code>res.error(status[, Error])</code>. </p>

<p>The following example will create GET routes that will return an empty <code>Array</code> at <code>/</code>, an <code>Error</code> at <code>/reports/tps</code>, &amp; a version 4 UUID at <code>/uuid</code>.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> uuid <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">"</span>tiny-uuid4<span class="pl-pds">"</span></span>);

<span class="pl-c1">module</span>.<span class="pl-smi">exports</span>.<span class="pl-smi">get</span> <span class="pl-k">=</span> {
    <span class="pl-s"><span class="pl-pds">"</span>/<span class="pl-pds">"</span></span><span class="pl-k">:</span> [<span class="pl-s"><span class="pl-pds">"</span>reports<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>uuid<span class="pl-pds">"</span></span>],
    <span class="pl-s"><span class="pl-pds">"</span>/reports<span class="pl-pds">"</span></span><span class="pl-k">:</span> [<span class="pl-s"><span class="pl-pds">"</span>tps<span class="pl-pds">"</span></span>],
    <span class="pl-s"><span class="pl-pds">"</span><span class="pl-en">/reports/tps</span><span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">req</span>, <span class="pl-smi">res</span>) {
        <span class="pl-smi">res</span>.<span class="pl-en">error</span>(<span class="pl-c1">785</span>, <span class="pl-en">Error</span>(<span class="pl-s"><span class="pl-pds">"</span>TPS Cover Sheet not attached<span class="pl-pds">"</span></span>));
    },
    <span class="pl-s"><span class="pl-pds">"</span><span class="pl-en">/uuid</span><span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">req</span>, <span class="pl-smi">res</span>) {
        <span class="pl-smi">res</span>.<span class="pl-c1">send</span>(<span class="pl-en">uuid</span>(), <span class="pl-c1">200</span>, {<span class="pl-s"><span class="pl-pds">"</span>cache-control<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>no-cache<span class="pl-pds">"</span></span>});
    }
};</pre></div>

<h4>
<a id="protected-routes" class="anchor" href="#protected-routes" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Protected Routes</h4>

<p>Protected routes are routes that require authorization for access, and will redirect to authentication end points if needed.</p>

<h4>
<a id="unprotected-routes" class="anchor" href="#unprotected-routes" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Unprotected Routes</h4>

<p>Unprotected routes are routes that do not require authorization for access, and will exit the authorization pipeline early to avoid rate limiting, csrf tokens, &amp; other security measures. These routes are the DMZ of your API! <em>You</em> <strong>must</strong> secure these end points with alternative methods if accepting input!</p>

<h3>
<a id="request-helpers" class="anchor" href="#request-helpers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Request Helpers</h3>

<p>Tensō decorates <code>req</code> with "helpers" such as <code>req.ip</code>, &amp; <code>req.parsed</code>. <code>PATCH</code>, <code>PUT</code>, &amp; <code>POST</code> payloads are available as <code>req.body</code>. Sessions are available as <code>req.session</code> when using <code>local</code> authentication.</p>

<h2>
<a id="responses" class="anchor" href="#responses" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Responses</h2>

<p>Responses will have a standard shape, and will be utf-8 by default. The result will be in <code>data</code>. Hypermedia (pagination, links, etc.) will be in <code>links:[ {"uri": "...", "rel": "..."}, ...]</code>, &amp; pagination will also be present via the <code>Link</code> HTTP header.</p>

<div class="highlight highlight-source-json"><pre>{
  <span class="pl-s"><span class="pl-pds">"</span>data<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>`null` or ?<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>error<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>`null` or an `Error` stack trace / message<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>links<span class="pl-pds">"</span></span>: [],
  <span class="pl-s"><span class="pl-pds">"</span>status<span class="pl-pds">"</span></span>: <span class="pl-c1">200</span>
}</pre></div>

<h2>
<a id="rest--hypermedia" class="anchor" href="#rest--hypermedia" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>REST / Hypermedia</h2>

<p>Hypermedia is a prerequisite of REST, and is best described by the <a href="http://martinfowler.com/articles/richardsonMaturityModel.html">Richardson Maturity Model</a>. Tensō will automagically paginate Arrays of results, or parse Entity representations for keys that imply
relationships, and create the appropriate Objects in the <code>link</code> Array, as well as the <code>Link</code> HTTP header. Object keys that match this pattern: <code>/_(guid|uuid|id|uri|url)$/</code> will be considered
hypermedia links.</p>

<p>For example, if the key <code>user_id</code> was found, it would be mapped to <code>/users/:id</code> with a link <code>rel</code> of <code>related</code>.</p>

<p>Tensō will bend the rules of REST when using authentication strategies provided by passport.js, or CSRF if is enabled, because they rely on a session. Session storage is in memory, or Redis. You have the option of a stateless or stateful API.</p>

<h2>
<a id="browsable-api--renderers" class="anchor" href="#browsable-api--renderers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Browsable API / Renderers</h2>

<p>Tensō 1.4.0 added a few common format renderers, such as CSV, HTML, YAML, &amp; XML. The HTML interface is a browsable API! You can use it to verify requests &amp; responses, or simply poke around your API to see how it behaves.</p>

<p>Custom renderers can be registered with <code>server.renderer('name', fn, 'mimetype');</code>.</p>

<h2>
<a id="cache" class="anchor" href="#cache" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Cache</h2>

<p>Tensō has a robust multi-level cache strategy, starting at the response headers. If a response can be cached, an <code>Etag</code> will be sent to the <code>Client</code>, and registered in an <code>Etag LRU cache</code> which Tensō 
uses along with a 'cache compressed asset to disk' strategy, allowing Tensō to stream the last known version of a resource to the next <code>Client</code> that supports the same compression (gzip or deflate).
<code>Etags</code> will lazy expire from the cache, to minimize wasted cycles.</p>

<p>Caching can be disabled by setting the <code>cache-control</code> header to a "private" or "no cache" directive (see the above <code>/uuid</code> example).</p>

<h2>
<a id="configuration" class="anchor" href="#configuration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Configuration</h2>

<p>This is a sample configuration for Tensō, without authentication or SSL. This would be ideal for development, but not production! Enabling SSL is as easy as providing file paths for the two keys.</p>

<pre><code>{
    "auth": {}, /* Optional, see Authentication section */
    "cacheSize": 1000, /* Optional, size of Etag LRU cache */
    "compress": false, /* Optional, enabled by default */
    "headers": {}, /* Optional, custom headers */
    "hostname": "localhost", /* Optional, default is 'localhost' */
    "json": 2, /* Optional, default indent for 'pretty' JSON */
    "logging": {
        "level": "info", /* Optional */
        "enabled": true, /* Optional */
        "stack": true /* Optional */
    },
    "port": 8000, /* Optional */
    "routes": require("./routes.js"), /* Required! */
    "session": { /* Optional */
        "secret": null,
        "store": "memory", /* "memory" or "redis" */
        "redis": {} /* See connect-redis for options */
    },
    "ssl": { /* Optional */
        "cert": null,
        "key": null
    },
    "title": "My API", /* Page title for browsable API */
    "uid": 33 /* Optional, system account uid to drop to after starting with elevated privileges to run on a low port */
}
</code></pre>

<h2>
<a id="authentication" class="anchor" href="#authentication" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Authentication</h2>

<p>The <code>protect</code> Array is the endpoints that will require authentication. The <code>redirect</code> String is the end point users will be redirected to upon successfully authenticating, the default is <code>/</code>.</p>

<p>Sessions are used for non <code>Basic</code> or <code>Bearer Token</code> authentication, and will have <code>/login</code>, <code>/logout</code>, &amp; custom routes. Redis is supported for session storage.</p>

<p>Multiple authentication strategies can be enabled at once.</p>

<h3>
<a id="basic-auth" class="anchor" href="#basic-auth" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Basic Auth</h3>

<pre><code>{
    "auth": {
        "basic": {
            "enabled": true,
            "list": ["username:password", ...],
        },
        "protect": ["/"]
    }
}
</code></pre>

<h3>
<a id="facebook" class="anchor" href="#facebook" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Facebook</h3>

<p>Facebook authentication will create <code>/auth</code>, <code>/auth/facebook</code>, &amp; <code>/auth/facebook/callback</code> routes. <code>auth(accessToken, refreshToken, profile, callback)</code> must execute <code>callback(err, user)</code>.</p>

<pre><code>{
    "auth": {
        "facebook": {
            "enabled": true,
            "auth": function ( ... ) { ... }, /* Authentication handler, to 'find' or 'create' a User */
            "client_id": "", /* Get this from Facebook */
            "client_secret": "" /* Get this from Facebook */
        },
        "protect": ["/private"]
    }
}
</code></pre>

<h3>
<a id="google" class="anchor" href="#google" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Google</h3>

<p>Google authentication (OpenID) will create <code>/auth</code>, <code>/auth/google</code>, &amp; <code>/auth/google/callback</code> routes. <code>auth(identifier, profile, callback)</code> must execute <code>callback(err, user)</code>.</p>

<pre><code>{
    "auth": {
        "google": {
            "enabled": true,
            "auth": function ( ... ) { ... }, /* Authentication handler, to 'find' or 'create' a User */
        },
        "protect": ["/private"]
    }
}
</code></pre>

<h3>
<a id="linkedin" class="anchor" href="#linkedin" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>LinkedIn</h3>

<p>LinkedIn authentication will create <code>/auth</code>, <code>/auth/linkedin</code>, &amp; <code>/auth/linkedin/callback</code> routes. <code>auth(token, tokenSecret, profile, callback)</code> must execute <code>callback(err, user)</code>.</p>

<pre><code>{
    "auth": {
        "linkedin": {
            "enabled": true,
            "auth": function ( ... ) { ... }, /* Authentication handler, to 'find' or 'create' a User */
            "client_id": "", /* Get this from LinkedIn */
            "client_secret": "", /* Get this from LinkedIn */,
            "scope": "" /* Optional, permission scope */
        }
        "protect": ["/private"]
    }
}
</code></pre>

<h3>
<a id="local" class="anchor" href="#local" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Local</h3>

<p>Local authentication will create <code>/login</code>. <code>auth(username, password)</code> must execute <code>callback(err, user)</code>.</p>

<pre><code>{
    "auth": {
        "local": {
            "enabled": true,
            "auth": function ( ... ) { ... }, /* Authentication handler, to 'find' or 'create' a User */
        }
        "protect": ["/private"]
    }
}
</code></pre>

<h3>
<a id="oauth2" class="anchor" href="#oauth2" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>OAuth2</h3>

<p>OAuth2 authentication will create <code>/auth</code>, <code>/auth/oauth2</code>, &amp; <code>/auth/oauth2/callback</code> routes. <code>auth(accessToken, refreshToken, profile, callback)</code> must execute <code>callback(err, user)</code>.</p>

<pre><code>{
    "auth": {
        "oauth2": {
            "enabled": true,
            "auth": function ( ... ) { ... }, /* Authentication handler, to 'find' or 'create' a User */
            "auth_url": "", /* Authorization URL */
            "token_url": "", /* Token URL */
            "client_id": "", /* Get this from authorization server */
            "client_secret": "" /* Get this from authorization server */
        },
        "protect": ["/private"]
    }
}
</code></pre>

<h3>
<a id="oauth2-bearer-token" class="anchor" href="#oauth2-bearer-token" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Oauth2 Bearer Token</h3>

<pre><code>{
    "auth": {
        "bearer": {
            "enabled": true,
            "tokens": ["abc", ...]
        },
        "protect": ["/"]
    }
}
</code></pre>

<h3>
<a id="saml" class="anchor" href="#saml" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>SAML</h3>

<p>SAML authentication will create <code>/auth</code>, <code>/auth/saml</code>, &amp; <code>/auth/saml/callback</code> routes. <code>auth(profile, callback)</code> must execute <code>callback(err, user)</code>.</p>

<p>Tensō uses <a href="https://github.com/bergie/passport-saml">passport-saml</a>, for configuration options please visit it's homepage.</p>

<pre><code>{
    "auth": {
        "saml": {
            "enabled": true,
            ...
        },
        "protect": ["/private"]
    }
}
</code></pre>

<h3>
<a id="twitter" class="anchor" href="#twitter" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Twitter</h3>

<p>Twitter authentication will create <code>/auth</code>, <code>/auth/twitter</code>, &amp; <code>/auth/twitter/callback</code> routes. <code>auth(token, tokenSecret, profile, callback)</code> must execute <code>callback(err, user)</code>.</p>

<pre><code>{
    "auth": {
        "twitter": {
            "enabled": true,
            "auth": function ( ... ) { ... }, /* Authentication handler, to 'find' or 'create' a User */
            "consumer_key": "", /* Get this from Twitter */
            "consumer_secret": "" /* Get this from Twitter */
        },
        "protect": ["/private"]
    }
}
</code></pre>

<h2>
<a id="sessions" class="anchor" href="#sessions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Sessions</h2>

<p>Sessions can use a memory (default) or redis store. Memory will limit your sessions to a single server instance, while redis will allow you to share sessions across a cluster of processes, or machines. To use redis, set the <code>store</code> property to "redis".</p>

<p>If the session <code>secret</code> is not provided, a version 4 <code>UUID</code> will be used.</p>

<pre><code>{
    "session" : {
        "secret": "my secret",
        "store": "redis",
        "redis": {
            "host": "127.0.0.1",
            "port": 6379
        }
    }
}
</code></pre>

<h2>
<a id="security" class="anchor" href="#security" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Security</h2>

<p>Tensō uses <a href="https://github.com/krakenjs/lusca#api">lusca</a> for security as a middleware. Please see it's documentation for how to configure it; each method &amp; argument is a key:value pair for <code>security</code>.</p>

<pre><code>{
    "security": { ... }
}
</code></pre>

<h2>
<a id="compression" class="anchor" href="#compression" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Compression</h2>

<p>Compression is enabled by default, for Clients that support <code>gzip</code> or <code>deflate</code>. Compression will be disabled if <code>SSL</code> is enabled.</p>

<h2>
<a id="rate-limiting" class="anchor" href="#rate-limiting" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Rate Limiting</h2>

<p>Rate limiting is controlled by configuration, and is disabled by default. Rate limiting is based on <code>token</code>, <code>session</code>, or <code>ip</code>, depending upon authentication method.</p>

<p>Rate limiting can be overridden by providing an <code>override</code> function that takes <code>req</code> &amp; <code>rate</code>, and must return (a modified) <code>rate</code>.</p>

<pre><code>{
    "rate": {
        "enabled": true,
        "limit": 450, /* Maximum requests allowed before `reset` */
        "reset": 900, /* TTL in seconds */
        "status": 429, /* Optional HTTP status */
        "message": "Too many requests",  /* Optional error message */
        "override": function ( req, rate ) { ... } /* Override the default rate limiting */
    }
}
</code></pre>

<h2>
<a id="limiting-upload-size" class="anchor" href="#limiting-upload-size" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Limiting upload size</h2>

<p>A 'max byte' limit can be enforced on all routes that handle <code>PATCH</code>, <code>POST</code>, &amp; <code>PUT</code> requests. The default limit is 1 MB (1048576 b).</p>

<pre><code>{
    "maxBytes": 5242880
}
</code></pre>

<h2>
<a id="logging" class="anchor" href="#logging" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Logging</h2>

<p>Standard log levels are supported, and are emitted to <code>stdout</code> &amp; <code>stderr</code>. Stack traces can be enabled.</p>

<pre><code>{
    "logging": {
        "level": "warn",
        "enabled": true,
        "stack": true
    }
}
</code></pre>

<h2>
<a id="websocket" class="anchor" href="#websocket" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>WebSocket</h2>

<p>A companion WebSocket server can be enabled by configuration, with event handlers (<code>connection</code>, <code>message</code>, &amp; <code>close</code>) set as a <code>socket</code> route.</p>

<p>Parameters for <code>message</code> are <code>socket, message, binary, server, tenso</code>, and <code>socket, server, tenso</code> for <code>connection</code> &amp; <code>close</code>.</p>

<p>Server options can be found <a href="https://github.com/alexhultman/node-lws#new-lwsserveroptions">here</a></p>

<pre><code>{
    "websocket": {
        "enabled": true,
        "options": {
            "port": 3000
        }
    }
}
</code></pre>

<h2>
<a id="coap" class="anchor" href="#coap" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>COAP</h2>

<p>A companion COAP server can be enabled by configuration, with a <code>request</code> event handler set as a <code>coap</code> route.</p>

<p>Parameters for <code>request</code> are <code>req, res, server, tenso</code>.</p>

<p>Server details can be found <a href="https://github.com/mcollina/node-coap#createserveroptions-requestlistener">here</a></p>

<pre><code>{
    "coap": {
        "enabled": true
    }
}
</code></pre>

<h2>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>License</h2>

<p>Copyright (c) 2016 Jason Mulligan<br>
Licensed under the BSD-3 license.</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/avoidwork/tenso">Tenso</a> is maintained by <a href="https://github.com/avoidwork">avoidwork</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
